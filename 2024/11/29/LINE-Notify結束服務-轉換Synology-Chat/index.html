<!DOCTYPE html><html lang="zh-TW"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>LINE Notify結束服務(轉換Synology Chat) | 天下本無事 庸人自擾之</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">LINE Notify結束服務(轉換Synology Chat)</h1><a id="logo" href="/.">天下本無事 庸人自擾之</a><p class="description">It's nothing to do with the world, but the mediocrity of the people!</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首頁</i></a><a href="/archives/"><i class="fa fa-archive"> 歸檔</i></a><a href="/about/"><i class="fa fa-user"> 關於</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">LINE Notify結束服務(轉換Synology Chat)</h1><div class="post-meta">2024-11-29</div><div class="post-content"><ul>
<li>緣起</li>
</ul>
<p>就….免錢的LINE Notify不給用!<br>然後…Messaging API又不太想付錢!484很容易懂~( ￣ 3￣)y▂ξ</p>
<span id="more"></span>

<ul>
<li><p>為什麼既要又要?<br>上一篇為Messaging API，這一篇就立馬Synology Chat?<br>哈<del>只能說應該是??? 公司可以不用</del>但不能沒有!<br>反正就Plan A 和Plan B<br>妃子和錢 誰會嫌少?就目前的風向來看!<br>上位的應該是Synology Chat!!!<br>(我認真的在想…我484花太多時間在看一些沒營養的劇?聽一些沒營養的書?) </p>
</li>
<li><p>那就開始吧!起手式一樣是<a target="_blank" rel="noopener" href="https://kb.synology.com/zh-tw/DSM/help/Chat/chat_integration?version=7#b_55">官方說明文件</a><br>比起Messaging API的天書…短的讓人想哭!就不能…好好做個人嗎?<br>只能說，不管又臭又長的天書還是這個短的”只有一頁”的說明!<br>事實上，第一眼都看不太懂!笑~<br>忽然覺得有點跳太快，也許? 可能? 484有一種人和我一樣?<br>並不太知道<strong>Synology Chat</strong> ?<br>總之 他都帶Synology了，簡單的說!他就是一個NAS的套件<br>和LINE有部份重疊的功能，可以拿來傳訊息??(什麼破介紹?<br>總之 必竟是名門正派，支援的比較全面，有手機的APP，各平台的桌面安裝程式。<br>如果本來NAS就用的比較全面!中間基本上沒有什麼設定就可以直接無痛上線。<br><a target="_blank" rel="noopener" href="https://www.synology.com/zh-tw/dsm/feature/chat">非技術性的Chat介紹</a></p>
</li>
<li><p>準備<br>1.一台可以安裝Chat套件的NAS主機(沒毛病<br>2.在NAS的套件中心將Synology Chat安裝起來<br> <img src="/../images/SynologyChat/1.jpg" alt="SynologyChat"><br>3.在列表中，找到Synology Chat管理主控台<br><img src="/../images/SynologyChat/2.jpg" alt="SynologyChat"><br>4.這裡面的選項，只有一個就續修改比較麻煩，就是你的<strong>帳號類型</strong>。<br>其他的後面要更改，基本上也不太痛。<br>本地使用者和網域使用者也很容易懂，基本上你的Nas應該本來就有在用某一種。<br>簡單的說就是你機器本來有沒有串網域?有串就選網域使用者!  <img src="/../images/SynologyChat/3.jpg" alt="SynologyChat"><br>5.在控制台→快速存取→開啟QuickConnect這個功能<br>這個功能應該9成己開啟，基本上就是不管你的網路環境如何?<br> 是否有固定對外的ip或網址，都可以快速的找到你的NAS主機。<br> 你在外網或使用手機APP時，一樣可以正常傳送和接收到資訊。<br> <img src="/../images/SynologyChat/4.jpg" alt="SynologyChat"><br> <img src="/../images/SynologyChat/5.jpg" alt="SynologyChat"><br> 到這邊，準備工作就結束了!再來就是開發了。  </p>
</li>
<li><p>讓程式傳送訊息給某個人  </p>
<blockquote>
<p>您可以透過 POST request 中的 payload 參數來指定要傳送的對象與訊息，例如：<br>payload&#x3D;{“text”: “First line of message to post in the channel.\nAlso you can have a second line of message.”, “user_ids”: [5] }<br>這代表訊息 First line of message to post in the channel.\nAlso you can have a second line of message.&gt; 已傳送給 user_id 為 5 的使用者。  </p>
<blockquote>
<p> 若要列出機器人可看到的使用者：<br>您可以發送請求至下列網址：<br>{Chat URL}&#x2F;webapi&#x2F;entry.cgi?api&#x3D;SYNO.Chat.External&amp;method&#x3D;user_list&amp;version&#x3D;2<br>並帶入以下參數：token &#x3D; bot token  </p>
</blockquote>
</blockquote>
<p>  以上轉於Synology Chat說明文件，只能說!還是比Messaging API容易一些!是吧????<br>  哈!怎辦 不好說!必竟Messaging API 非常的整齊！有一種莫明的爽感!測試上也舒服!<br>  我的環境是有串domain的，所以我的使用者名稱&#x3D;domain使用者名稱。<br>  我的作法是，取得所有Nas上的username和user_id後，用username再串回公司的員工資料。<br>  <del>再排程同步(檢查一下世界那麼大想不開想去走走的啊、火坑這麼多，跳那不是跳的新勇者)</del><br>  組合出，員編和user_id，這樣的資料以應付未來的開發需求，但大家的環境應該不太一樣!<br>  但反正就是取出username和user_id(或其他更多欄位)後再看看要怎麼配合公司的資料，變出花來? öㅅö<br>  必竟，很單純，指定某個user_id扔出去!就完事了! </p>
<p>  啊!忘了參數 token，取得所有user_id需要token，必竟是自己的機器，取得token也容易的多。<br>  先登入Chat，於帳號處，選擇整合功能→機器人→新建<br>  主要就是最下面的 <strong>識別標記(token)和傳入網址(webhookUrl)</strong> 。<br>  取所有Userid時會用到token，而傳入網址則可以直接抄來發送訊息時使用。<br>  <img src="/../images/SynologyChat/6.jpg" alt="SynologyChat"><br>  <img src="/../images/SynologyChat/7.jpg" alt="SynologyChat"><br>  <img src="/../images/SynologyChat/8.jpg" alt="SynologyChat"><br>  <img src="/../images/SynologyChat/9.jpg" alt="SynologyChat"><br>  <img src="/../images/SynologyChat/10.jpg" alt="SynologyChat"><br>  取得token後，就可以用token取得所有的user_id。<br>  參考程式如下(Web Forms C# )</p>
  <figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">GetUserDataAsync</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> url = <span class="string">&quot;https://主機IP/webapi/entry.cgi?api=SYNO.Chat.External&amp;method=user_list&amp;version=2&amp;token=token;</span></span><br><span class="line"><span class="string">    using (HttpClient client = new HttpClient())</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        try</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            HttpResponseMessage response = await client.GetAsync(url);</span></span><br><span class="line"><span class="string">            response.EnsureSuccessStatusCode();</span></span><br><span class="line"><span class="string">            byte[] responseBytes = await response.Content.ReadAsByteArrayAsync();</span></span><br><span class="line"><span class="string">            string responseBody = Encoding.UTF8.GetString(responseBytes);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            // 解析 JSON 資料</span></span><br><span class="line"><span class="string">            JObject json = JObject.Parse(responseBody);</span></span><br><span class="line"><span class="string">            var users = json[&quot;</span>data<span class="string">&quot;][&quot;</span>users<span class="string">&quot;];</span></span><br><span class="line"><span class="string">            foreach (var user in users)</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                string username = user[&quot;</span>username<span class="string">&quot;].ToString();</span></span><br><span class="line"><span class="string">                int userId = (int)user[&quot;</span>user_id<span class="string">&quot;];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                // 在這裡處理 username 和 user_id，寫入和顯示在頁面上</span></span><br><span class="line"><span class="string">                GetChatUserIds(userId, username);</span></span><br><span class="line"><span class="string">                lblShow.Text += $&quot;</span>Username: &#123;username&#125;, User ID: &#123;userId&#125;&lt;br&gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            lblShow.Text += &quot;</span>已完成更新使用者ID&lt;br&gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        catch (HttpRequestException e)</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            // 處理錯誤</span></span><br><span class="line"><span class="string">            lblShow.Text = e.Message;</span></span><br><span class="line"><span class="string">        &#125; &#125;&#125;</span></span><br></pre></td></tr></table></figure>
<p>當有User_id後，再來就是傳送訊息啦!</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SendChatMsg</span>(<span class="params">string_EmpId, <span class="built_in">string</span> _Msg</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//這邊是我的環境需要empid轉chatuser_id，可以直接給chatuser_id直接吃!</span></span><br><span class="line">    <span class="built_in">string</span> ChatUserId = GetChatUserIdByEmpNo(_EmpId);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(ChatUserId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> webhookUrl = <span class="string">&quot;yourwebhookUrl&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> message = _Msg;</span><br><span class="line">        <span class="built_in">string</span> user_ids = <span class="string">$&quot;[<span class="subst">&#123;ChatUserId&#125;</span>]&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> payload = <span class="string">$&quot;&amp;payload=&#123;&#123;\&quot;text\&quot;: \&quot;<span class="subst">&#123;HttpUtility.UrlEncode(message)&#125;</span>\&quot;, \&quot;user_ids\&quot;: <span class="subst">&#123;user_ids&#125;</span>&#125;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">         HttpWebRequest request = (HttpWebRequest)WebRequest.Create(webhookUrl + payload);</span><br><span class="line">        request.Method = <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> response = request.GetResponse())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">using</span> (Stream dataStream = response.GetResponseStream())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">using</span> (<span class="keyword">var</span> reader = <span class="keyword">new</span> StreamReader(dataStream))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">string</span> requestResult = reader.ReadToEnd();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最後的最後，只能說!轉換愉快啊!(눈‸눈)</p>
<p><a target="_blank" rel="noopener" href="https://buymeacoffee.com/lovecatwu"><img src="/../images/cat2.png" alt="請我喝一杯吧"></a></p>
</li>
</ul>
</div><div class="tags"></div><div class="post-nav"><a class="next" href="/2024/10/28/LINE-Notify%E7%B5%90%E6%9D%9F%E6%9C%8D%E5%8B%99-%E8%BD%89%E6%8F%9BMessaging-API/">LINE Notify結束服務(轉換Messaging API)</a></div><script src="https://utteranc.es/client.js" repo="Cat914006/comments" issue-term="title" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://cat914006.github.io"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="關於"><img class="nofancybox" src="/img/mycat.png"/></a><p>Live a good life.</p><a class="info-icon" href="https://www.instagram.com/catwu999/" title="instagram" target="_blank" style="margin-inline:5px"> <i class="fa fa-instagram" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/Cat914006" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分類</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 標籤</i></div><div class="tagcloud"><a href="/tags/%E5%B7%A5%E4%BD%9C/" style="font-size: 15px;">工作</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/11/29/LINE-Notify%E7%B5%90%E6%9D%9F%E6%9C%8D%E5%8B%99-%E8%BD%89%E6%8F%9BSynology-Chat/">LINE Notify結束服務(轉換Synology Chat)</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/10/28/LINE-Notify%E7%B5%90%E6%9D%9F%E6%9C%8D%E5%8B%99-%E8%BD%89%E6%8F%9BMessaging-API/">LINE Notify結束服務(轉換Messaging API)</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/09/02/%E5%96%AE%E4%B8%80%E7%99%BB%E5%85%A5-NET-Framework-3-5-%E4%B8%B2%E4%B8%80%E4%B8%8B-NET-Framework-4-7/">單一登入(.NET Framework 3.5 串一下.NET Framework 4.7)</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/15/%E6%B8%AC%E4%B8%80%E4%B8%8B/">監視器影像(RTSP)崁入自己的網站</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/12/hello-world/">Hello World & I'm Still Here</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">天下本無事 庸人自擾之.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="複製成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>